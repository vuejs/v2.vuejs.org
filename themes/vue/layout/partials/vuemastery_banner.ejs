<div id="vm-banner" class="vuemastery-banner hide" role="banner">
  <a href="https://www.vuemastery.com/free-weekend" target="_blank">
    <img class="vuemastery-banner--logo" src="/images/logo-vuemastery.svg" alt="vuemastery" />
    <div class="vuemastery-banner--wrapper">
      <p>Free Vue Courses on Vue Mastery Feb 22 - Feb 24.<span>Sign up today to get access.</span></p>
    </div>
    <div id="vm-close" class="vuemastery-banner--close"></div>
  </a>
</div>

<script>
  (function () {
    var elBody = document.getElementsByTagName('body')[0];
    var elBanner = document.getElementById('vm-banner');
    var elClose = document.getElementById('vm-close');
    var elMenu = document.getElementById('mobile-bar');
    var nameWrapper = 'vuemastery-weekend-promo';
    var nameFixMenu = 'vuemastery-menu-fixed';
    var nameStorage = 'vuemastery-banner';
    var isMenuFixed, posMenu;

    // Initialise banner after checking user preference
    var initBanner = function () {
      // Add class to the body to push fixed elements
      elBody.classList.add(nameWrapper);
      // Display the banner
      elBanner.style.display = 'block';
      // Get the menu position
      getMenuPosition();
      // Check current page offset position
      isMenuFixed = isUnderBanner();
      // And position menu accordingly
      if (isMenuFixed) elBody.classList.add('fixed');
    }

    // Remove the banner once the user decide to close
    var closeBanner = function(e) {
      // Prevent bubbling event that redirect to vuemastery.com
      e.preventDefault();
      // Remove events
      toggleBannerEvents(false);
      // Hide the banner
      elBanner.style.display = 'none';
      // Remove class to the body that push fixed elements
      elBody.classList.remove(nameWrapper);
      // Save action in the local storage
      localStorage.setItem(nameStorage, true);
    }

    // Get position of the menu
    var getMenuPosition = function() {
      posMenu = elBanner.clientHeight;
    }

    // Check if menu should be fixed
    var isUnderBanner = function() {
      return window.pageYOffset > posMenu;
    }

    // This allow the mobile menu to scroll once the banner is not visible
    var fixMenuAfterBanner = function() {
      if (isUnderBanner()) {
        if (!isMenuFixed) {
          // The menu will be fixed
          elBody.classList.add(nameFixMenu);
          isMenuFixed = true;
        }
      } else if (isMenuFixed) {
        // The menu stay under the banner
        elBody.classList.remove(nameFixMenu);
        isMenuFixed = false;
      }
    }

    // Add or remove event listerners attached to the DOM
    var toggleBannerEvents = function (on) {
      var method = on ? 'addEventListener' : 'removeEventListener';
      window[method]('resize', getMenuPosition);
      window[method]('scroll', fixMenuAfterBanner);
    }

    // Check if user already removed the banner
    if(!localStorage.getItem(nameStorage)) {
      // Add event listeners
      toggleBannerEvents(true);
      // Load component
      initBanner();
    }
  })()
</script>
